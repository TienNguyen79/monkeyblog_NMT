"use strict";(self.webpackChunkreact_monkey_blogging_boilerplate=self.webpackChunkreact_monkey_blogging_boilerplate||[]).push([[556],{4556:function(e,t,n){n.r(t);var i,a=n(1413),s=n(5861),r=n(9439),l=n(168),o=n(7757),c=n.n(o),u=n(2791),d=n(6031),h=n(6356),f=n(3453),m=n(9248),g=n(6024),p=n(460),v=(n(8119),n(5421)),x=n(1134),b=n(333),Z=n.n(b),y=(n(3585),n(3031)),w=n(4490),k=(n(4961),n(9062)),j=n(1199),q=n(5727),A=n(4170),E=n(9808),I=n(577),P=n(6871),N=n(6770),S=n.n(N),C=(n(6009),n(5179)),D=n(184);N.Quill.register("modules/imageUploader",C.Z);var T=d.ZP.div(i||(i=(0,l.Z)([""])));t.default=function(){var e=(0,E.a)().userInfo,t=(0,u.useState)(""),n=(0,r.Z)(t,2),i=n[0],l=n[1],o=(0,x.cI)({mode:"onChange",defaultValues:{title:"",slug:"",status:2,category:{},hot:!1,user:{},content:""}}),d=o.control,b=(o.watch,o.setValue),N=o.handleSubmit,C=o.getValues,L=o.reset,F=(0,w.Z)(b,C),H=F.handleSelectImage,B=F.setImage,U=F.setProgress,_=F.handleDeleteImage,O=F.progress,J=F.image,M=F.imageName;(0,u.useEffect)((function(){function t(){return(t=(0,s.Z)(c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.email){t.next=2;break}return t.abrupt("return");case 2:return n=(0,k.IO)((0,k.hJ)(j.db,"users"),(0,k.ar)("email","==",e.email)),t.next=5,(0,k.PL)(n);case 5:t.sent.forEach((function(e){b("user",(0,a.Z)({id:e.id},e.data()))}));case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[e.email]);var R=(0,u.useState)([]),V=(0,r.Z)(R,2),Q=V[0],X=V[1],Y=(0,u.useState)(""),$=(0,r.Z)(Y,2),z=$[0],G=$[1],K=(0,u.useState)(!1),W=(0,r.Z)(K,2),ee=W[0],te=W[1],ne=(0,P.s0)(),ie=(0,u.useMemo)((function(){return{toolbar:[["bold","italic","underline","strike"],["blockquote"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{header:[1,2,3,4,5,6,!1]}],["link","image"]]}}),[]);(0,u.useEffect)((function(){function e(){return(e=(0,s.Z)(c().mark((function e(){var t,n,i,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,k.hJ)(j.db,"categories"),n=(0,k.IO)(t,(0,k.ar)("status","==",1)),e.next=4,(0,k.PL)(n);case 4:i=e.sent,s=[],i.forEach((function(e){s.push((0,a.Z)({id:e.id},e.data()))})),X(s);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);var ae=function(){var e=(0,s.Z)(c().mark((function e(t){var n,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,k.JU)(j.db,"categories",t.id),e.next=3,(0,k.QT)(n);case 3:i=e.sent,b("category",(0,a.Z)({id:i.id},i.data())),G(t);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,u.useEffect)((function(){document.title="Monkey - Add new Posts"}));var se=function(){var e=(0,s.Z)(c().mark((function e(t){var n,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return te(!0),e.prev=1,(n=(0,a.Z)({},t)).slug=Z()(t.slug||t.title,{lower:!0}),n.status=Number(t.status),console.log(n),s=(0,k.hJ)(j.db,"posts"),e.next=9,(0,k.ET)(s,(0,a.Z)((0,a.Z)({},n),{},{image:J,imageName:M,content:i,createdAt:(0,k.Bt)()}));case 9:ne("/my-post"),I.Am.success("Create new Posts successfully!!"),L({title:"",slug:"",status:2,category:{},user:{},hot:!1,image:"",content:""}),B(""),U(0),G({}),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(1),te(!1);case 20:return e.prev=20,te(!1),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[1,17,20,23]])})));return function(t){return e.apply(this,arguments)}}();return(0,D.jsxs)(T,{children:[(0,D.jsx)("h1",{className:"dashboard-heading",children:"Add new post"}),(0,D.jsxs)("form",{action:"",onSubmit:N(se),children:[(0,D.jsxs)("div",{className:"grid grid-cols-1 gap-x-10 mb-10 items-start md:grid-cols-2 md:gap-x-10 md:mb-10 md:items-start",children:[(0,D.jsxs)(h.Z,{children:[(0,D.jsx)(f.Z,{children:"Title"}),(0,D.jsx)(m.Z,{control:d,placeholder:"Enter your title",name:"title",required:!0})]}),(0,D.jsxs)(h.Z,{children:[(0,D.jsx)(f.Z,{children:"Slug"}),(0,D.jsx)(m.Z,{control:d,placeholder:"Enter your slug",name:"slug"})]})]}),(0,D.jsxs)("div",{className:"grid grid-cols-1 gap-x-10 mb-10 items-start md:grid-cols-2 md:gap-x-10 md:mb-10 md:items-start",children:[(0,D.jsxs)(h.Z,{children:[(0,D.jsx)(f.Z,{children:"Image"}),(0,D.jsx)(y.Z,{onChange:H,className:"h-[250px]",handleDeleteImage:_,progress:O,image:J})]}),(0,D.jsxs)(h.Z,{children:[(0,D.jsx)(f.Z,{children:"Category"}),(0,D.jsxs)(g.Z,{children:[(0,D.jsx)(q.Z,{placeholder:z.name||"Select the category"}),(0,D.jsx)(A.Z,{children:Q.length>0&&Q.map((function(e){return(0,D.jsx)(v.Z,{onClick:function(){return ae(e)},children:e.name},e.name)}))})]})]})]}),(0,D.jsxs)("div",{className:"mb-10 entry-content",children:[(0,D.jsx)(f.Z,{children:"Content"}),(0,D.jsx)("div",{className:"mt-4",children:(0,D.jsx)(S(),{modules:ie,theme:"snow",value:i,onChange:l,className:"w-full max-w-[350px] md:max-w-[760px] lg:max-w-full "})})]}),(0,D.jsx)("div",{className:"flex mr-14",children:(0,D.jsx)(p.Z,{type:"submit",className:"mx-auto w-[200px]",isLoading:ee,disable:ee,children:"Add new post"})})]})]})}},5179:function(e,t,n){n.d(t,{Z:function(){return m}});var i=n(5671),a=n(3144),s=n(1752),r=n(1120),l=n(136),o=n(3668),c=n(6921),u=n.n(c),d=function(e){(0,l.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"deleteAt",value:function(e,t){(0,s.Z)((0,r.Z)(n.prototype),"deleteAt",this).call(this,e,t),this.cache={}}}],[{key:"create",value:function(e){var t=(0,s.Z)((0,r.Z)(n),"create",this).call(this,e);if(!0===e)return t;var i=document.createElement("img");return i.setAttribute("src",e),t.appendChild(i),t}},{key:"value",value:function(e){var t=e.dataset;return{src:t.src,custom:t.custom}}}]),n}(u().import("blots/block"));d.blotName="imageBlot",d.className="image-uploading",d.tagName="span",u().register({"formats/imageBlot":d});var h=d,f=function(){function e(t,n){(0,i.Z)(this,e),this.quill=t,this.options=n,this.range=null,this.placeholderDelta=null,"function"!==typeof this.options.upload&&console.warn("[Missing config] upload function that returns a promise is required");var a=this.quill.getModule("toolbar");a&&a.addHandler("image",this.selectLocalImage.bind(this)),this.handleDrop=this.handleDrop.bind(this),this.handlePaste=this.handlePaste.bind(this),this.quill.root.addEventListener("drop",this.handleDrop,!1),this.quill.root.addEventListener("paste",this.handlePaste,!1)}return(0,a.Z)(e,[{key:"selectLocalImage",value:function(){var e=this;this.quill.focus(),this.range=this.quill.getSelection(),this.fileHolder=document.createElement("input"),this.fileHolder.setAttribute("type","file"),this.fileHolder.setAttribute("accept","image/*"),this.fileHolder.setAttribute("style","visibility:hidden"),this.fileHolder.onchange=this.fileChanged.bind(this),document.body.appendChild(this.fileHolder),this.fileHolder.click(),window.requestAnimationFrame((function(){document.body.removeChild(e.fileHolder)}))}},{key:"handleDrop",value:function(e){var t=this;if(e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length){if(e.stopPropagation(),e.preventDefault(),document.caretRangeFromPoint){var n=document.getSelection(),i=document.caretRangeFromPoint(e.clientX,e.clientY);n&&i&&n.setBaseAndExtent(i.startContainer,i.startOffset,i.startContainer,i.startOffset)}else{var a=document.getSelection(),s=document.caretPositionFromPoint(e.clientX,e.clientY);a&&s&&a.setBaseAndExtent(s.offsetNode,s.offset,s.offsetNode,s.offset)}this.quill.focus(),this.range=this.quill.getSelection();var r=e.dataTransfer.files[0];setTimeout((function(){t.quill.focus(),t.range=t.quill.getSelection(),t.readAndUploadFile(r)}),0)}}},{key:"handlePaste",value:function(e){var t=this,n=e.clipboardData||window.clipboardData;if(n&&(n.items||n.files))for(var i=n.items||n.files,a=/^image\/(jpe?g|gif|png|svg|webp)$/i,s=0;s<i.length;s++)a.test(i[s].type)&&function(){var n=i[s].getAsFile?i[s].getAsFile():i[s];n&&(t.quill.focus(),t.range=t.quill.getSelection(),e.preventDefault(),setTimeout((function(){t.quill.focus(),t.range=t.quill.getSelection(),t.readAndUploadFile(n)}),0))}()}},{key:"readAndUploadFile",value:function(e){var t=this,n=!1,i=new FileReader;i.addEventListener("load",(function(){if(!n){var e=i.result;t.insertBase64Image(e)}}),!1),e&&i.readAsDataURL(e),this.options.upload(e).then((function(e){t.insertToEditor(e)}),(function(e){n=!0,t.removeBase64Image(),console.warn(e)}))}},{key:"fileChanged",value:function(){var e=this.fileHolder.files[0];this.readAndUploadFile(e)}},{key:"insertBase64Image",value:function(e){var t=this.range;this.placeholderDelta=this.quill.insertEmbed(t.index,h.blotName,"".concat(e),"user")}},{key:"insertToEditor",value:function(e){var t=this.range,n=this.calculatePlaceholderInsertLength();this.quill.deleteText(t.index,n,"user"),this.quill.insertEmbed(t.index,"image","".concat(e),"user"),t.index++,this.quill.setSelection(t,"user")}},{key:"calculatePlaceholderInsertLength",value:function(){return this.placeholderDelta.ops.reduce((function(e,t){return t.hasOwnProperty("insert")&&e++,e}),0)}},{key:"removeBase64Image",value:function(){var e=this.range,t=this.calculatePlaceholderInsertLength();this.quill.deleteText(e.index,t,"user")}}]),e}();window.ImageUploader=f;var m=f}}]);
//# sourceMappingURL=556.8d8fa259.chunk.js.map